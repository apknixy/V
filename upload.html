<!DOCTYPE html>
<html>
<head>
  <title>VideoFire - Upload</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="firebase.js"></script>
</head>

<body style="background:#121212;color:white;text-align:center;">

  <h1>ðŸ”¥ VideoFire - Upload Video</h1>

  <input id="ytlink" placeholder="YouTube Link" style="width:80%;padding:10px;"><br><br>
  <input id="title" placeholder="Video Title" style="width:80%;padding:10px;"><br><br>
  <input id="tags" placeholder="Tags (comma separated)" style="width:80%;padding:10px;"><br><br>
  <textarea id="desc" placeholder="Description" style="width:80%;padding:10px;"></textarea><br><br>
  <button onclick="upload()">Upload</button><br><br>

  <a href="reels.html" style="color:yellow;">Back to Home</a>

  <script>
    firebase.auth().onAuthStateChanged(function(user) {
      if (!user) {
        location.href = "index.html";
      }
    });

    function extractVideoID(url) {
      // Clean YT URLs & get Video ID
      url = url.split('?')[0].replace('youtu.be/', 'youtube.com/watch?v=');
      let id = url.split('v=')[1] || url.split('/shorts/')[1];
      if (id.includes("&")) id = id.split("&")[0];
      return id;
    }

    function upload() {
      const user = firebase.auth().currentUser;
      const uid = user.uid;

      const ytlink = document.getElementById("ytlink").value.trim();
      const title = document.getElementById("title").value.trim();
      const tags = document.getElementById("tags").value.trim();
      const desc = document.getElementById("desc").value.trim();

      if (ytlink === "" || title === "") {
        alert("Please enter all fields");
        return;
      }

      const videoID = extractVideoID(ytlink);
      const thumbnail = `https://img.youtube.com/vi/${videoID}/0.jpg`;
      const embedLink = `https://www.youtube.com/embed/${videoID}`;

      const key = firebase.database().ref().child("videos").push().key;
      firebase.database().ref("videos/" + key).set({
        uid: uid,
        ytID: videoID,
        embed: embedLink,
        thumbnail: thumbnail,
        title: title,
        tags: tags,
        desc: desc,
        views: 0,
        likes: 0,
        uploadTime: Date.now()
      }).then(() => {
        alert("Video Uploaded Successfully!");
        location.href = "reels.html";
      });
    }
  </script>

</body>
</html>
